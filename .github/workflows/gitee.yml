# 工作流名称
name: Sync GitHub to Gitee

# 触发条件：当 GitHub 仓库有 push/merge 等操作时触发
on:
  push:
    branches: [ "main", "master", "dev" ] # 监听的分支（根据实际情况调整）
  pull_request:
    branches: [ "main", "master", "dev" ]
    types: [ closed ]
    if: github.event.pull_request.merged == true

# 工作流任务
jobs:
  sync:
    # 运行环境：Ubuntu 最新版
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出 GitHub 仓库A的代码（拉取所有历史，确保分支/标签完整）
      - name: Checkout GitHub repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 必须设置为0，否则仅拉取最新提交，无法同步所有分支

      # 步骤2：配置 Git 用户名和邮箱（Gitee 提交记录需要）
      - name: Configure Git user
        run: |
          git config --global user.name "GitHub Actions" # 可自定义
          git config --global user.email "actions@github.com" # 可自定义

      # 步骤3：添加 Gitee 仓库B作为远程仓库
      - name: Add Gitee remote repo
        run: |
          git remote add gitee https://bmg369:${{ secrets.GITEE_TOKEN }}@gitee.com/bmg369/test.git

      # 步骤4：推送所有分支和标签到 Gitee 仓库B
      - name: Push to Gitee
        run: |
          # 推送所有分支
          git push --all gitee
          # 推送所有标签（可选，不需要可注释）
          git push --tags gitee
